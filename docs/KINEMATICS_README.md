# 機械手臂運動學控制系統使用說明

## 概述
這是一個完整的機械手臂運動學控制系統，提供：
- 正向/逆向運動學計算
- 點位記錄與管理
- 路徑規劃與軌跡生成
- 3D視覺化模擬
- 動畫演示

## 安裝需求

```bash
pip install -r kinematics_requirements.txt
```

## 啟動程式

```bash
python kinematics_control.py
```

## 主要功能

### 1. 關節控制標籤頁
- **關節角度控制**：使用滑動條或數值框控制四個關節
- **末端效應器顯示**：即時顯示末端效應器的XYZ座標
- **3D視覺化**：右側即時顯示機械手臂姿態

### 2. 點位記錄標籤頁
- **記錄當前點位**：一鍵記錄當前機械手臂末端位置
- **手動輸入點位**：直接輸入XYZ座標新增目標點
- **點位管理**：清單顯示、刪除、清除、儲存/載入功能

### 3. DH參數標籤頁
- **可編輯的DH表格**：根據實際機械手臂修改參數
- **預設參數**：
  ```
  關節1 (底座): θ=0°,   d=100mm,  a=0mm,    α=90°
  關節2 (大臂): θ=90°,  d=0mm,    a=150mm,  α=0°  
  關節3 (小臂): θ=0°,   d=0mm,    a=120mm,  α=0°
  關節4 (夾爪): θ=0°,   d=0mm,    a=80mm,   α=0°
  ```

### 4. 路徑規劃標籤頁
- **軌跡規劃**：在記錄的點位間生成平滑軌跡
- **動畫模擬**：3D動畫展示機械手臂運動
- **軌跡執行**：可輸出角度序列供實際控制

## 使用流程

### 基本操作流程：
1. **調整DH參數**：根據實際機械手臂規格修改DH表格
2. **記錄點位**：
   - 手動調整關節角度到目標姿態
   - 點擊「記錄當前點位」
   - 或直接在「手動輸入點位」中輸入座標
3. **規劃路徑**：點擊「規劃路徑」生成軌跡
4. **預覽模擬**：點擊「動畫模擬」查看運動過程
5. **執行軌跡**：確認無誤後點擊「執行路徑」

### 高級功能：
- **點位儲存/載入**：將點位序列儲存為JSON檔案
- **軌跡分析**：查看每個軌跡點的詳細角度資訊
- **即時視覺化**：所有操作都有即時3D反饋

## DH參數設定指南

DH參數表格格式：[θ, d, a, α]

- **θ (theta)**：關節角度（度）
- **d**：沿Z軸位移（mm）  
- **a**：沿X軸位移（mm）
- **α (alpha)**：繞X軸旋轉（度）

### 修改步驟：
1. 進入「DH參數」標籤頁
2. 在表格中修改數值
3. 點擊「更新參數」套用變更
4. 使用「重置預設」恢復原始設定

### 測量建議：
- 使用游標卡尺測量實際連桿長度
- 參考機械手臂技術規格書
- 透過實際測試微調參數

## 運動學說明

### 正向運動學 (Forward Kinematics)
- 輸入：關節角度 [θ1, θ2, θ3, θ4]
- 輸出：末端效應器位置 [X, Y, Z]
- 使用DH變換矩陣串聯計算

### 逆向運動學 (Inverse Kinematics)  
- 輸入：目標位置 [X, Y, Z]
- 輸出：關節角度 [θ1, θ2, θ3, θ4]
- 使用牛頓-拉夫遜迭代法求解
- 包含奇異性檢查和關節限制

### 路徑規劃
- **線性插值**：在點位間生成中間點
- **軌跡優化**：自動生成3個中繼點
- **逆解計算**：為每個軌跡點求解關節角度

## 注意事項

1. **關節限制**：
   - 關節1：-180° ~ +180°
   - 關節2：-90° ~ +90°
   - 關節3：-135° ~ +135°
   - 關節4：-180° ~ +180°

2. **工作空間**：
   - 有效工作範圍約400mm半徑
   - 避免奇異位置
   - 注意自碰撞檢查

3. **數值穩定性**：
   - 逆解可能無解或多解
   - 建議提供合理的初始角度
   - 檢查求解成功標誌

## 與實際機械手臂整合

在 `execute_trajectory()` 函數中可以加入實際控制程式碼：

```python
def execute_trajectory(self):
    # 連接實際機械手臂控制器
    import serial
    ser = serial.Serial('COM3', 115200)
    
    for angles in self.trajectory_angles:
        # 發送角度命令
        command = f"{angles[0]},{angles[1]},{angles[2]},{angles[3]}\n"
        ser.write(command.encode())
        time.sleep(0.5)  # 等待動作完成
```

## 故障排除

### 常見問題：
1. **逆解失敗**：目標點超出工作範圍或處於奇異位置
2. **動畫卡頓**：點位過多，調整軌跡點數量
3. **視覺化異常**：重新啟動程式或調整DH參數

### 解決方案：
- 檢查目標點是否在合理範圍內
- 確認DH參數設定正確
- 調整逆解迭代參數（容差、最大迭代次數）